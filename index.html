<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parrillita de Pepe - Sistema Administrativo</title>
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    
    <!-- Estilos principales -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Librerías -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <span class="logo-text">Parrillita de Pepe<span class="logo-highlight"></span></span>
                </div>
                <p class="sidebar-subtitle">Sistema Administrativo</p>
            </div>

            <div class="user-profile" id="userProfile">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                    <span class="user-name" id="userName">Invitado</span>
                    <span class="user-role" id="userRole">Sin sesión</span>
                </div>
                <button class="user-login-btn" id="userLoginBtn" onclick="mostrarLogin()" aria-label="Iniciar sesión">
                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                </button>
            </div>

            <nav class="sidebar-nav" aria-label="Menú principal">
                <div class="nav-section">
                    <span class="nav-section-title">PRINCIPAL</span>
                    <a href="#" onclick="cambiarModulo('dashboard'); return false;" class="nav-item active" data-module="dashboard" aria-current="page">
                        <i class="fas fa-chart-pie" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" onclick="cambiarModulo('ventas'); return false;" class="nav-item" data-module="ventas">
                        <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                        <span>Ventas</span>
                    </a>
                    <a href="#" onclick="cambiarModulo('costos'); return false;" class="nav-item" data-module="costos">
                        <i class="fas fa-coins" aria-hidden="true"></i>
                        <span>Costos Fijos</span>
                    </a>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">OPERACIONES</span>
                    <a href="#" onclick="cambiarModulo('planilla'); return false;" class="nav-item" data-module="planilla">
                        <i class="fas fa-users" aria-hidden="true"></i>
                        <span>Planilla</span>
                    </a>
                    <a href="#" onclick="cambiarModulo('servicios'); return false;" class="nav-item" data-module="servicios">
                        <i class="fas fa-bolt" aria-hidden="true"></i>
                        <span>Servicios</span>
                    </a>
                    <a href="#" onclick="cambiarModulo('merma'); return false;" class="nav-item" data-module="merma">
                        <i class="fas fa-trash-alt" aria-hidden="true"></i>
                        <span>Merma</span>
                    </a>
                    <a href="#" onclick="cambiarModulo('logistica'); return false;" class="nav-item" data-module="logistica">
                        <i class="fas fa-truck" aria-hidden="true"></i>
                        <span>Logística</span>
                    </a>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">FINANZAS</span>
                    <a href="#" onclick="cambiarModulo('pyg'); return false;" class="nav-item" data-module="pyg">
                        <i class="fas fa-file-invoice-dollar" aria-hidden="true"></i>
                        <span>P&G</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="footer-btn" onclick="exportarDatos()" aria-label="Exportar datos">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    <span>Exportar</span>
                </button>
                <button class="footer-btn" onclick="importarDatos()" aria-label="Importar datos">
                    <i class="fas fa-upload" aria-hidden="true"></i>
                    <span>Importar</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <header class="top-bar">
                <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()" aria-label="Alternar menú">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>

                <div class="filters">
                    <div class="filter-group">
                        <label for="filtroLocal" class="sr-only">Filtrar por local</label>
                        <i class="fas fa-store filter-icon" aria-hidden="true"></i>
                        <select id="filtroLocal" class="filter-select" aria-label="Seleccionar local">
                            <option value="Todos">Todos los locales</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filtroTiempo" class="sr-only">Filtrar por período</label>
                        <i class="fas fa-calendar filter-icon" aria-hidden="true"></i>
                        <select id="filtroTiempo" class="filter-select" aria-label="Seleccionar período">
                            <option value="todos">Todo</option>
                            <option value="dia">Hoy</option>
                            <option value="mes">Este mes</option>
                            <option value="anio">Este año</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filtroMes" class="sr-only">Seleccionar mes</label>
                        <i class="fas fa-calendar-alt filter-icon" aria-hidden="true"></i>
                        <input type="text" 
                               id="filtroMes" 
                               class="filter-input" 
                               placeholder="YYYY-MM"
                               pattern="\d{4}-\d{2}"
                               title="Formato: YYYY-MM (ej: 2026-02)"
                               aria-label="Seleccionar mes en formato AAAA-MM"
                               value="">
                    </div>
                </div>

                <div class="header-actions">
                    <button class="header-btn" onclick="refrescarDatos()" title="Refrescar datos" aria-label="Refrescar">
                        <i class="fas fa-sync-alt" aria-hidden="true"></i>
                        <span class="sr-only">Refrescar</span>
                    </button>
                    <button class="header-btn" onclick="generarReporte()" title="Generar reporte PDF" aria-label="Generar PDF">
                        <i class="fas fa-file-pdf" aria-hidden="true"></i>
                        <span class="sr-only">Generar PDF</span>
                    </button>
                    <button class="header-btn" onclick="mostrarNotificaciones()" title="Notificaciones" aria-label="Notificaciones">
                        <i class="fas fa-bell" aria-hidden="true"></i>
                        <span class="sr-only">Notificaciones</span>
                        <span class="notification-badge">3</span>
                    </button>
                </div>
            </header>

            <div class="modules">
                <!-- Dashboard -->
                <section id="dashboard" class="module active" aria-labelledby="dashboard-title">
                    <div class="module-header">
                        <h1 class="module-title" id="dashboard-title">Dashboard</h1>
                        <div class="module-actions">
                            <button class="btn btn-outline" onclick="exportarDashboard()" aria-label="Exportar dashboard">
                                <i class="fas fa-download" aria-hidden="true"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div class="module-content" id="dashboardContent">
                        <!-- Contenido dinámico desde JavaScript -->
                    </div>
                </section>

                <!-- Ventas -->
                <section id="ventas" class="module" aria-labelledby="ventas-title">
                    <div class="module-header">
                        <h1 class="module-title" id="ventas-title">Ventas</h1>
                        <div class="module-actions">
                        </div>
                    </div>
                    <div class="module-content" id="ventasContent">
                        <!-- El contenido se llena desde ventas.js -->
                    </div>
                </section>

                <!-- Costos Fijos -->
                <section id="costos" class="module" aria-labelledby="costos-title">
                    <div class="module-header">
                    <div class="module-content" id="costosContent">
                        <!-- El contenido se llena desde costos.js -->
                    </div>
                </section>

                <!-- Planilla -->
                <section id="planilla" class="module" aria-labelledby="planilla-title">
                    <div class="module-header">
                        <h1 class="module-title" id="planilla-title">Planilla</h1>
                        <div class="module-actions">
                            <button class="btn btn-primary" onclick="mostrarModalEmpleado()" aria-label="Agregar empleado">
                                <i class="fas fa-user-plus" aria-hidden="true"></i> Agregar Empleado
                            </button>
                            <button class="btn btn-success" onclick="calcularPlanilla()" aria-label="Calcular planilla">
                                <i class="fas fa-calculator" aria-hidden="true"></i> Calcular
                            </button>
                        </div>
                    </div>
                    <div class="module-content" id="planillaContent">
                        <!-- Contenido dinámico -->
                    </div>
                </section>

                <!-- Servicios -->
                <section id="servicios" class="module" aria-labelledby="servicios-title">
                    <div class="module-header">
                        <h1 class="module-title" id="servicios-title">Servicios</h1>
                        <div class="module-actions">
                            <button class="btn btn-primary" onclick="mostrarModalServicio()" aria-label="Registrar lectura">
                                <i class="fas fa-plus" aria-hidden="true"></i> Registrar Lectura
                            </button>
                        </div>
                    </div>
                    <div class="module-content" id="serviciosContent">
                        <!-- Contenido dinámico -->
                    </div>
                </section>

                <!-- Merma -->
                <section id="merma" class="module" aria-labelledby="merma-title">
                    <div class="module-header">
                        <h1 class="module-title" id="merma-title">Control de Merma</h1>
                        <div class="module-actions">
                            <button class="btn btn-primary" onclick="mostrarModalMerma()" aria-label="Registrar merma">
                                <i class="fas fa-plus" aria-hidden="true"></i> Registrar Merma
                            </button>
                        </div>
                    </div>
                    <div class="module-content" id="mermaContent">
                        <!-- Contenido dinámico -->
                    </div>
                </section>

                <!-- Logística -->
                <section id="logistica" class="module" aria-labelledby="logistica-title">
                    <div class="module-header">
                        <h1 class="module-title" id="logistica-title">Logística</h1>
                        <div class="module-actions">
                            <button class="btn btn-primary" onclick="mostrarModalLogistica()" aria-label="Registrar gasto">
                                <i class="fas fa-plus" aria-hidden="true"></i> Registrar Gasto
                            </button>
                        </div>
                    </div>
                    <div class="module-content" id="logisticaContent">
                        <!-- Contenido dinámico -->
                    </div>
                </section>

                <!-- P&G -->
                <section id="pyg" class="module" aria-labelledby="pyg-title">
                    <div class="module-header">
                        <h1 class="module-title" id="pyg-title">Pérdidas y Ganancias</h1>
                        <div class="module-actions">
                            <button class="btn btn-outline" onclick="generarPyG()" aria-label="Generar reporte P&G">
                                <i class="fas fa-file-pdf" aria-hidden="true"></i> Generar Reporte
                            </button>
                        </div>
                    </div>
                    <div class="module-content" id="pygContent">
                        <!-- Contenido dinámico -->
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modal de Login -->
    <div class="modal-overlay" id="modalOverlay" onclick="cerrarModal()" aria-hidden="true"></div>
    
    <div class="modal" id="loginModal" role="dialog" aria-labelledby="loginModalTitle" aria-modal="true">
        <div class="modal-header">
            <h2 id="loginModalTitle"><i class="fas fa-lock" aria-hidden="true"></i> Iniciar Sesión</h2>
            <button class="modal-close" onclick="cerrarModal()" aria-label="Cerrar">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="loginForm" onsubmit="event.preventDefault(); procesarLogin();">
                <div class="form-group">
                    <label for="loginRol">
                        <i class="fas fa-user-tag" aria-hidden="true"></i> Rol
                    </label>
                    <select id="loginRol" class="form-control" required aria-required="true">
                        <option value="gerencia">Gerencia</option>
                        <option value="encargado" selected>Encargado</option>
                    </select>
                </div>
                
                <div class="form-group" id="loginLocalGroup">
                    <label for="loginLocal">
                        <i class="fas fa-store" aria-hidden="true"></i> Local
                    </label>
                    <select id="loginLocal" class="form-control">
                        <option value="">Seleccionar local...</option>
                    </select>
                </div>

                <div class="form-info" role="status" aria-live="polite">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    <span>Demo: cualquier combinación funciona</span>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Ingresar
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para agregar venta (UNO SOLO, bien definido) -->
    <!-- Modal para agregar venta - VERSIÓN CORREGIDA -->
<!-- Modal para agregar venta - CON LABELS CORRECTOS -->
<div class="modal" id="ventaModal" role="dialog" aria-labelledby="ventaModalTitle" aria-modal="true" style="max-width: 900px; width: 95%;">
    <div class="modal-header">
        <h2 id="ventaModalTitle"><i class="fas fa-shopping-cart"></i> Registrar Venta</h2>
        <button class="modal-close" onclick="cerrarModal('ventaModal')" aria-label="Cerrar">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <form id="ventaForm" onsubmit="event.preventDefault(); guardarVenta();">
            
            <!-- Fecha y Local con labels correctos -->
            <div style="display: flex; gap: 20px; margin-bottom: 25px;">
                <div style="flex: 1;">
                    <label for="ventaFecha" style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                        <i class="fas fa-calendar" style="color: #2563eb; margin-right: 8px;"></i>Fecha
                    </label>
                    <input type="date" id="ventaFecha" name="ventaFecha" class="form-control" required style="width: 100%; padding: 12px;" title="Seleccione la fecha de la venta">
                </div>
                <div style="flex: 2;">
                    <label for="ventaLocal" style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                        <i class="fas fa-store" style="color: #2563eb; margin-right: 8px;"></i>Local
                    </label>
                    <select id="ventaLocal" name="ventaLocal" class="form-control" required style="width: 100%; padding: 12px;" title="Seleccione el local donde se realizó la venta">
                        <option value="">Seleccionar local...</option>
                    </select>
                </div>
            </div>

            <!-- DOS COLUMNAS -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                
                <!-- COLUMNA IZQUIERDA: PUNTO DE VENTA -->
                <div style="background: #f8fafc; padding: 20px; border-radius: 16px;">
                    <h3 style="font-size: 1.1rem; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <i class="fas fa-cash-register" style="color: #2563eb; margin-right: 8px;"></i> Punto de Venta
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label for="ventaEfectivo" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Efectivo</label>
                            <input type="number" id="ventaEfectivo" name="ventaEfectivo" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Monto en efectivo">
                        </div>
                        <div>
                            <label for="ventaBAC" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Tarjeta (BAC)</label>
                            <input type="number" id="ventaBAC" name="ventaBAC" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Monto con tarjeta BAC">
                        </div>
                        <div>
                            <label for="ventaPersonal" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Personal</label>
                            <input type="number" id="ventaPersonal" name="ventaPersonal" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Ventas a empleados">
                        </div>
                        <div>
                            <label for="ventaGastos" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Gastos/Cortesías</label>
                            <input type="number" id="ventaGastos" name="ventaGastos" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Gastos y cortesías">
                        </div>
                    </div>
                </div>

                <!-- COLUMNA DERECHA: DELIVERY -->
                <div style="background: #f8fafc; padding: 20px; border-radius: 16px;">
                    <h3 style="font-size: 1.1rem; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <i class="fas fa-motorcycle" style="color: #2563eb; margin-right: 8px;"></i> Delivery
                    </h3>
                    
                    <!-- Pedidos Ya -->
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 2;">
                                <label for="ventaPedidosYa" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Pedidos Ya</label>
                                <input type="number" id="ventaPedidosYa" name="ventaPedidosYa" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Monto de Pedidos Ya">
                            </div>
                            <div style="flex: 1; background: white; padding: 8px 12px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <div style="font-size: 0.7rem; color: #64748b;">Comisión 18%</div>
                                <div id="comisionPedidosYa" style="font-weight: 600; color: #ef4444;" title="Comisión calculada">₡0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Didi Food -->
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 2;">
                                <label for="ventaDidi" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Didi Food</label>
                                <input type="number" id="ventaDidi" name="ventaDidi" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Monto de Didi Food">
                            </div>
                            <div style="flex: 1; background: white; padding: 8px 12px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <div style="font-size: 0.7rem; color: #64748b;">Comisión 18%</div>
                                <div id="comisionDidi" style="font-weight: 600; color: #ef4444;" title="Comisión calculada">₡0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Uber Eats -->
                    <div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 2;">
                                <label for="ventaUber" style="display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 4px;">Uber Eats</label>
                                <input type="number" id="ventaUber" name="ventaUber" class="form-control" value="0" min="0" step="100" oninput="calcularTotalesVenta()" style="padding: 12px;" title="Monto de Uber Eats">
                            </div>
                            <div style="flex: 1; background: white; padding: 8px 12px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <div style="font-size: 0.7rem; color: #64748b;">Comisión 10%</div>
                                <div id="comisionUber" style="font-weight: 600; color: #ef4444;" title="Comisión calculada">₡0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RESUMEN -->
            <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 20px; border-radius: 16px; color: white; margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                    <div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">Ventas Brutas</div>
                        <div style="font-size: 1.5rem; font-weight: 700;" id="ventasBrutas" title="Total de ventas antes de comisiones">₡0</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">Comisiones</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fca5a5;" id="totalComisiones" title="Total de comisiones de delivery">₡0</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">Gastos/Cortesías</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fca5a5;" id="totalGastos" title="Total de gastos y cortesías">₡0</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">Ventas Netas</div>
                        <div style="font-size: 1.8rem; font-weight: 700; color: #4ade80;" id="ventasNetas" title="Ventas después de comisiones y gastos">₡0</div>
                    </div>
                </div>
            </div>

            <!-- BOTONES -->
            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button type="button" class="btn btn-outline" onclick="cerrarModal('ventaModal')" style="padding: 12px 30px;" title="Cancelar y cerrar">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="submit" class="btn btn-success" style="padding: 12px 40px;" title="Guardar la venta">
                    <i class="fas fa-save"></i> Guardar Venta
                </button>
            </div>
        </form>
    </div>
</div>

    <!-- Scripts - ORDEN CORRECTO: app.js primero, luego ventas.js -->
    <script src="app.js"></script>
    <script src="modules/ventas.js"></script>
    <script src="modules/costos.js"></script>
</body>
</html>